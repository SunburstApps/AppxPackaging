<Project>
  <UsingTask AssemblyFile="$(AppxBuildTasksAssembly)" TaskName="Sunburst.AppxPackaging.BuildTasks.AppxConvertTargetPaths" />

  <Target Name="_AppxPackageGetProjectFiles" DependsOnTargets="ResolveReferences;GenerateSatelliteAssemblies;_CopyAppConfigFile" Returns="@(_AppxProjectFile)">
    <RemoveDuplicates Inputs="@(ReferenceCopyLocalPaths);@(ReferenceSatellitePaths);$(TargetPath)">
      <Output TaskParameter="Filtered" ItemName="_AppXProjectFileWithoutMetadata"/>
    </RemoveDuplicates>

    <MSBuild Projects="$(MSBuildProjectFullPath)" Targets="GetItemTargetPaths">
      <Output TaskParameter="TargetOutputs" ItemName="_AppxItemWithTargetPath" />
    </MSBuild>
    <AppxConvertTargetPaths InputItems="@(_AppxItemWithTargetPath)" RootDestination="$(_AppXDestination)">
      <Output TaskParameter="OutputItems" ItemName="_PossibleAppxProjectFile" />
    </AppxConvertTargetPaths>
    <ItemGroup>
      <_AppxProjectFile Include="@(_PossibleAppxProjectFile)" Condition="Exists('%(Identity)')">
        <Destination>%(_PossibleAppxProjectFile.Destination)</Destination>
      </_AppxProjectFile>
    </ItemGroup>

    <ItemGroup>
      <_AppxProjectFile Include="@(_AppXProjectFileWithoutMetadata)">
        <Destination>$(_AppXDestination)</Destination>
      </_AppxProjectFile>
    </ItemGroup>

    <ItemGroup Condition="Exists('$(TargetPath).config')">
      <_AppxProjectFile Include="$(TargetPath).config">
        <Destination>$(_AppXDestination)</Destination>
      </_AppxProjectFile>
    </ItemGroup>

    <ItemGroup>
      <_Satellites Include="@(EmbeddedResource -> '$(ProjectDir)$(OutputPath)%(Culture)\$(TargetName).resources.dll')" Condition="'%(EmbeddedResource.Culture)' != ''" />
    </ItemGroup>
    <ItemGroup>
      <_AppxProjectFile Include="@(_Satellites)">
        <Destination>$(_AppXDestination)\%(_Satellites.Culture)</Destination>
      </_AppxProjectFile>
    </ItemGroup>
  </Target>
  
  <Target Name="_AppXPackagePrintProjectFiles">
    <CallTarget Targets="_AppXPackageGetProjectFiles">
      <Output TaskParameter="TargetOutputs" ItemName="_Temporary" />
    </CallTarget>
    <Message Importance="high" Text="@(_Temporary, '&#xD;&#xA;')" />
  </Target>
</Project>
